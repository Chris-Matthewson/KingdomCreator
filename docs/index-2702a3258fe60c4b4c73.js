!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=38)}([function(e,t){e.exports=ko},function(e,t){e.exports=jQuery},function(e,t,r){var n,i,o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};n=[r,t,r(11),r(20),r(5),r(6),r(7),r(8),r(9)],void 0===(i=function(e,t,r,n,i,s,a,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(){}return e.convertToSetId=function(e){var t=this.convertToSetIdSafe(e);if(!t)throw new Error("Unknown set ID: "+t);return t},e.convertToSetIdSafe=function(e){var t,r,n=Object.keys(d.SetId);try{for(var i=o(n),s=i.next();!s.done;s=i.next()){var a=s.value;if(d.SetId[a]==e)return e}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return null},e.getAllSets=function(){var t,r,n=[],i=Object.keys(e.sets);try{for(var s=o(i),a=s.next();!a.done;a=s.next()){var d=a.value;n.push(e.sets[d])}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return n},e.getSetById=function(t){return e.sets[t]},e.getCardById=function(t){var r=e.cards[t];if(!r)throw new Error("Unknown card id: {$cardId}");return r},e.getSupplyCardById=function(t){var r=e.getCardById(t);if(!(r instanceof u.SupplyCard))throw new Error("Card id ({$cardId}) does not refer to a supply card");return r},e.getEventById=function(t){var r=e.getCardById(t);if(!(r instanceof i.Event))throw new Error("Card id ({$cardId}) does not refer to an event");return r},e.getLandmarkById=function(t){var r=e.getCardById(t);if(!(r instanceof s.Landmark))throw new Error("Card id ({$cardId}) does not refer to a landmark");return r},e.getProjectById=function(t){var r=e.getCardById(t);if(!(r instanceof a.Project))throw new Error("Card id ({$cardId}) does not refer to a project");return r},e.getBoonById=function(t){var n=e.getCardById(t);if(!(n instanceof r.Boon))throw new Error("Card id ({$cardId}) does not refer to a boon");return n},e.createSets=function(){var e,t,r=Object.keys(window.DominionSets),i={};try{for(var s=o(r),a=s.next();!a.done;a=s.next()){var d=a.value;i[d]=n.DominionSet.fromJson(window.DominionSets[d])}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return i},e.createCardMap=function(){var t,r,n,i,s={},a=Object.keys(e.sets);try{for(var d=o(a),u=d.next();!u.done;u=d.next()){var l=u.value,c=e.sets[l],p=c.supplyCards.concat(c.events,c.landmarks,c.projects,c.boons);try{for(var f=(n=void 0,o(p)),h=f.next();!h.done;h=f.next()){var y=h.value;s[y.id]=y,s[y.shortId]||(s[y.shortId]=y)}}catch(e){n={error:e}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=d.return)&&r.call(d)}finally{if(t)throw t.error}}return s},e.sets=e.createSets(),e.cards=e.createCardMap(),e}();t.DominionSets=l}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i,o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};n=[r,t,r(5),r(6),r(7),r(9)],void 0===(i=function(e,t,r,n,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){}return e.getAllCardsFromSets=function(t){var r,n,i=[];try{for(var s=o(t),a=s.next();!a.done;a=s.next()){var d=a.value;i=i.concat(e.getAllCardsFromSet(d))}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i},e.getAllCardsFromSet=function(e){return e.supplyCards.concat(e.events,e.landmarks,e.projects)},e.getAllSupplyCards=function(t){return e.getCardsOfType(t,s.SupplyCard)},e.getAllEvents=function(t){return e.getCardsOfType(t,r.Event)},e.getAllLandmarks=function(t){return e.getCardsOfType(t,n.Landmark)},e.getAllProjects=function(t){return e.getCardsOfType(t,i.Project)},e.getCardsOfType=function(e,t){var r,n,i=[];try{for(var s=o(e),a=s.next();!a.done;a=s.next()){var d=a.value;d instanceof t&&i.push(d)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i},e.extractIds=function(e){return e.map(function(e){return e.id})},e.unionCards=function(t,r){return t.filter(e.filterByExcludedIds(e.extractIds(r))).concat(r)},e.findCardById=function(e,t){var r,n;try{for(var i=o(e),s=i.next();!s.done;s=i.next()){var a=s.value;if(a.id==t)return a}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return null},e.filterSetsByAllowedSetIds=function(e,t){var r,n,i=[];try{for(var s=o(e),a=s.next();!a.done;a=s.next()){var d=a.value;-1!=t.indexOf(d.setId)&&i.push(d)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i},e.filterByIncludedSetIds=function(e){return function(t){return-1!=e.indexOf(t.setId)}},e.filterByExcludedSetIds=function(e){return function(t){return-1==e.indexOf(t.setId)}},e.filterByIncludedIds=function(e){return function(t){return-1!=e.indexOf(t.id)}},e.filterByExcludedIds=function(e){return function(t){return-1==e.indexOf(t.id)}},e.filterByAllowedTypes=function(e){return function(t){var r,n;try{for(var i=o(e),s=i.next();!s.done;s=i.next()){var a=s.value;if(t.isOfType(a))return!0}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return!1}},e.filterByExcludedTypes=function(e){return function(t){var r,n;try{for(var i=o(e),s=i.next();!s.done;s=i.next()){var a=s.value;if(t.isOfType(a))return!1}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return!0}},e.filterByRequiredType=function(e){return function(t){return!e||t.isOfType(e)}},e.filterByAllowedCosts=function(e){return function(t){return-1!=e.indexOf(t.cost.getType())}},e.filterByExcludedCosts=function(e){return function(t){return-1==e.indexOf(t.cost.getType())}},e}();t.Cards=a}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(14)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r){this.treasure=e,this.potion=t,this.debt=r}return e.prototype.getType=function(){return[r.CostType.TREASURE_2_OR_LESS,r.CostType.TREASURE_2_OR_LESS,r.CostType.TREASURE_2_OR_LESS,r.CostType.TREASURE_3,r.CostType.TREASURE_4,r.CostType.TREASURE_5,r.CostType.TREASURE_6,r.CostType.TREASURE_7,r.CostType.TREASURE_8_OR_MORE][Math.min(this.treasure,8)]},e.fromJson=function(t){return new e(t.treasure||0,t.potion||0,t.debt||0)},e}();t.Cost=n}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(4)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n,i,o,s,a,d,u){this.id=e,this.shortId=t,this.setId=r,this.name=n,this.cost=i,this.isActionSupplier=o,this.isBuySupplier=s,this.isDrawer=a,this.isReaction=d,this.isTrashing=u}return e.fromJson=function(t){return new e(t.id,t.shortId,t.setId,t.name,r.Cost.fromJson(t.cost),t.isActionSupplier||!1,t.isBuySupplier||!1,t.isDrawer||!1,t.isReaction||!1,t.isTrashing||!1)},e}();t.Event=n}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(4)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n,i){this.id=e,this.shortId=t,this.setId=r,this.name=n,this.cost=i}return e.fromJson=function(t){return new e(t.id,t.shortId,t.setId,t.name,r.Cost.fromJson(t.cost))},e}();t.Landmark=n}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(4)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n,i){this.id=e,this.shortId=t,this.setId=r,this.name=n,this.cost=i}return e.fromJson=function(t){return new e(t.id,t.shortId,t.setId,t.name,r.Cost.fromJson(t.cost))},e}();t.Project=n}.apply(t,n))||(e.exports=i)},function(e,t,r){var n;void 0===(n=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ADVENTURES="adventures",e.ALCHEMY="alchemy",e.BASE_SET="baseset",e.BASE_SET_2="baseset2",e.CORNUCOPIA="cornucopia",e.DARK_AGES="darkages",e.EMPIRES="empires",e.GUILDS="guilds",e.HINTERLANDS="hinterlands",e.INTRIGUE="intrigue",e.INTRIGUE_2="intrigue2",e.NOCTURNE="nocturne",e.PROMOS="promos",e.PROSPERITY="prosperity",e.RENAISSANCE="renaissance",e.SEASIDE="seaside"}(t.SetId||(t.SetId={}))}.apply(t,[r,t]))||(e.exports=n)},function(e,t,r){var n,i;n=[r,t,r(10),r(4)],void 0===(i=function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,r,n,i,o,s,a,d,u,l,c,p,f,h,y,v,g,S,C){this.id=e,this.shortId=t,this.setId=r,this.name=n,this.cost=i,this.isAction=o,this.isActionSupplier=s,this.isAttack=a,this.isBuySupplier=d,this.isDrawer=u,this.isDoom=l,this.isDuration=c,this.isFate=p,this.isMultiDrawer=f,this.isNight=h,this.isReaction=y,this.isReserve=v,this.isTrashing=g,this.isTreasure=S,this.isVictory=C}return e.prototype.isOfType=function(e){switch(e){case r.CardType.ACTION:return this.isAction;case r.CardType.ACTION_SUPPLIER:return this.isActionSupplier;case r.CardType.ATTACK:return this.isAttack;case r.CardType.BUY_SUPPLIER:return this.isBuySupplier;case r.CardType.DRAWER:return this.isDrawer;case r.CardType.DOOM:return this.isDoom;case r.CardType.DURATION:return this.isDuration;case r.CardType.FATE:return this.isFate;case r.CardType.MULTI_DRAWER:return this.isMultiDrawer;case r.CardType.NIGHT:return this.isNight;case r.CardType.REACTION:return this.isReaction;case r.CardType.RESERVE:return this.isReserve;case r.CardType.TRASHING:return this.isTrashing;case r.CardType.TREASURE:return this.isTreasure;case r.CardType.VICTORY:return this.isVictory;default:throw new Error("Unknown card type: "+e)}},e.fromJson=function(t){return new e(t.id,t.shortId,t.setId,t.name,n.Cost.fromJson(t.cost),t.isAction||!1,t.isActionSupplier||!1,t.isAttack||!1,t.isBuySupplier||!1,t.isDrawer||!1,t.isDoom||!1,t.isDuration||!1,t.isFate||!1,t.isMultiDrawer||!1,t.isNight||!1,t.isReaction||!1,t.isReserve||!1,t.isTrashing||!1,t.isTreasure||!1,t.isVictory||!1)},e}();t.SupplyCard=i}.apply(t,n))||(e.exports=i)},function(e,t,r){var n;void 0===(n=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ACTION="isAction",e.ACTION_SUPPLIER="isActionSupplier",e.ATTACK="isAttack",e.BUY_SUPPLIER="isBuySupplier",e.DRAWER="isDrawer",e.DOOM="isDoom",e.DURATION="isDuration",e.FATE="isFate",e.MULTI_DRAWER="isMultiDrawer",e.NIGHT="isNight",e.REACTION="isReaction",e.RESERVE="isReserve",e.TRASHING="isTrashing",e.TREASURE="isTreasure",e.VICTORY="isVictory"}(t.CardType||(t.CardType={}))}.apply(t,[r,t]))||(e.exports=n)},function(e,t,r){var n;void 0===(n=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r,n){this.id=e,this.shortId=t,this.setId=r,this.name=n}return e.fromJson=function(t){return new e(t.id,t.shortId,t.setId,t.name)},e}();t.Boon=r}.apply(t,[r,t]))||(e.exports=n)},function(e,t,r){var n;void 0===(n=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,r,n,i){this.supply=e,this.events=t,this.landmarks=r,this.projects=n,this.metadata=i};t.Kingdom=r;var n=function(e,t){this.useColonies=e,this.useShelters=t};t.Metadata=n}.apply(t,[r,t]))||(e.exports=n)},function(e,t,r){var n,i;n=[r,t,r(0),r(28)],void 0===(i=function(e,t,r,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.RANDOMIZER=0]="RANDOMIZER",e[e.SETS=1]="SETS"}(i=t.MenuItem||(t.MenuItem={}));var o=function(){function e(t,n){this.subtitle=r.observable(t),this.showMenu=r.observable(!1),this.menuItems=e.createMenuItems(n),this.isCondensed=r.observable(!1)}return e.prototype.toggleMenu=function(){var e=!this.showMenu();e&&$(window).scrollTop(0),this.showMenu(e)},e.createMenuItems=function(e){return[new n.MenuItemViewModel("Randomizer","/index.html",e==i.RANDOMIZER),new n.MenuItemViewModel("Recommended Kingdoms","/sets.html",e==i.SETS)]},e}();t.Page=o}.apply(t,n))||(e.exports=i)},function(e,t,r){var n;void 0===(n=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.TREASURE_2_OR_LESS="treasure2",e.TREASURE_3="treasure3",e.TREASURE_4="treasure4",e.TREASURE_5="treasure5",e.TREASURE_6="treasure6",e.TREASURE_7="treasure7",e.TREASURE_8_OR_MORE="treasure8"}(t.CostType||(t.CostType={}))}.apply(t,[r,t]))||(e.exports=n)},function(e,t,r){var n;void 0===(n=function(e,t){"use strict";function r(e,t){return Math.floor(Math.random()*(t-e)+e)}Object.defineProperty(t,"__esModule",{value:!0}),t.getRandomInt=r,t.getRandomInts=function(e,t){for(var n=new Set,i=Math.min(e,t);n.size<i;)n.add(r(0,t));return n}}.apply(t,[r,t]))||(e.exports=n)},function(e,t,r){var n,i;n=[r,t,r(0),r(1),r(17)],void 0===(i=function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=800;function s(e){e.isCondensed(n(window).width()<=o)}t.initialize=function(e){i.initializeBindingHandlers(),n(document).ready(function(){r.applyBindings(e),n(window).on("resize",function(){return s(e)}),s(e)})}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(18),r(19),r(21),r(22),r(23),r(24),r(25),r(26),r(27)],void 0===(i=function(e,t,r,n,i,o,s,a,d,u,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initializeBindingHandlers=function(){r.bindCardImage(),n.bindDominionSetName(),i.bindDominionSetNames(),o.bindFadeIn(),s.bindScaleOffWidthOfImage(),a.bindShowFloating(),d.bindShowMenu(),u.bindSlideVisible(),l.bindWithCard()}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(0)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="/img/cards";t.bindCardImage=function(){r.bindingHandlers.cardImage={update:function(e,t,r,i,o){var s=t(),a="string"==typeof s?s:s.id;e.src=n+"/"+a+".jpg"}}}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(0),r(1),r(2)],void 0===(i=function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bindDominionSetName=function(){r.bindingHandlers.dominionSetName={update:function(e,t,r,o,s){var a=t(),d="string"==typeof a?a:a.setId,u=i.DominionSets.getSetById(d);n(e).html('<span class="set-name '+d+'">'+u.name+"</span>")}}}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(11),r(9),r(5),r(6),r(7)],void 0===(i=function(e,t,r,n,i,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,r,n,i,o,s){this.setId=e,this.name=t,this.supplyCards=r,this.events=n,this.landmarks=i,this.projects=o,this.boons=s}return e.fromJson=function(t){return new e(t.id,t.name,(t.cards||[]).map(n.SupplyCard.fromJson),(t.events||[]).map(i.Event.fromJson),(t.landmarks||[]).map(o.Landmark.fromJson),(t.projects||[]).map(s.Project.fromJson),(t.boons||[]).map(r.Boon.fromJson))},e}();t.DominionSet=a}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i,o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};n=[r,t,r(0),r(1),r(2)],void 0===(i=function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bindDominionSetNames=function(){r.bindingHandlers.dominionSetNames={update:function(e,t,s,a,d){var u,l,c=r.unwrap(t()),p=[];try{for(var f=o(c),h=f.next();!h.done;h=f.next()){var y=h.value,v=i.DominionSets.getSetById(y);p.push('<span class="set-name '+y+'">'+v.name+"</span>")}}catch(e){u={error:e}}finally{try{h&&!h.done&&(l=f.return)&&l.call(f)}finally{if(u)throw u.error}}n(e).html(p.join(" "))}}}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(0),r(1)],void 0===(i=function(e,t,r,n){"use strict";function i(e,t){t?(e.show(),setTimeout(function(){e.css("opacity","1")},0)):(e.hide(),e.css("opacity","0"))}Object.defineProperty(t,"__esModule",{value:!0}),t.bindFadeIn=function(){r.bindingHandlers.fadeIn={init:function(e,t,o,s,a){i(n(e),r.unwrap(t()))},update:function(e,t,o,s,a){var d=n(e),u=r.unwrap(t());!!u!=(1==Number(d.css("opacity")))&&i(d,u)}}}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(0),r(1)],void 0===(i=function(e,t,r,n){"use strict";function i(e,t){var r=e.height(),n=t.naturalHeight/t.naturalWidth;n&&e.height(e.width()*n);var i=e.height();return r!=i&&0!=i}Object.defineProperty(t,"__esModule",{value:!0}),t.bindScaleOffWidthOfImage=function(){r.bindingHandlers.scaleOffWidthOfImage={init:function(e,t,o,s,a){var d=r.unwrap(t()),u=r.unwrap(d.selector),l=n(e),c=l.find(u).eq(0),p=c.get(0);r.utils.domData.set(e,"image",p);var f=function(){i(l,p)};n(window).on("resize",f),c.on("load",f),f()},update:function(e,t,o,s,a){r.unwrap(r.unwrap(t()).trigger);var d=n(e),u=r.utils.domData.get(e,"image");i(d,u)||setTimeout(function(){i(d,u)},0)}}}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(0)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=8;t.bindShowFloating=function(){r.bindingHandlers.showFloating={init:function(e,t,i,o,s){var a=$(r.utils.unwrapObservable(t())),d=$(e),u=$(window);u.scroll(function(){var e=a.offset().top-n;u.scrollTop()>e&&o.isCondensed()?(d.addClass("visible"),a.addClass("hidden")):(d.removeClass("visible"),a.removeClass("hidden"))})}}}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(0),r(1)],void 0===(i=function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bindShowMenu=function(){r.bindingHandlers.showMenu={init:function(e,t,i,o,s){n(window).on("resize",function(){var t=n(e),i=t.children(),o=r.utils.domData.get(e,"showMenu-enabled"),s=r.utils.domData.get(e,"showMenu-show");o&&t.height(s?i.outerHeight():0)})},update:function(e,t,i,o,s){var a=r.unwrap(t()),d=r.unwrap(a.enabled),u=r.unwrap(a.show),l=n(e);r.utils.domData.set(e,"showMenu-enabled",d),r.utils.domData.set(e,"showMenu-show",u),d?l.height(u?l.children().outerHeight():0):l.css("height","auto")}}}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(0)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bindSlideVisible=function(){r.bindingHandlers.slideVisible={update:function(e,t,n,i,o){var s=r.unwrap(t()),a=n.get("slideDuration")||400;s?$(e).slideDown(a):$(e).slideUp(a)}}}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(0),r(2)],void 0===(i=function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bindWithCard=function(){r.bindingHandlers.withCard={init:function(e,t,i,o,s){var a=n.DominionSets.getCardById(r.unwrap(t()));return r.bindingHandlers.with.init(e,function(){return a},i,o,s)},update:function(e,t,i,o,s){var a=n.DominionSets.getCardById(r.unwrap(t()));return r.bindingHandlers.with.update(e,function(){return a},i,o,s)}}}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(0)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,n){this.title=e,this.url=t,this.isActive=r.observable(!!n)};t.MenuItemViewModel=n}.apply(t,n))||(e.exports=i)},function(e,t,r){var n;void 0===(n=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t){this.supplyCards=e,this.metadata=t};t.Supply=r;var n=function(e,t,r,n){this.builder=e,this.prioritizedSetId=t,this.numberOfAlchemyCardsInUse=r,this.numberOfHighCostCardsInUse=n};t.Metadata=n}.apply(t,[r,t]))||(e.exports=n)},function(e,t,r){var n,i;n=[r,t,r(0)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){this.setId=e.setId,this.name=e.name,this.isActive=r.observable(t)};t.SetViewModel=n}.apply(t,n))||(e.exports=i)},function(e,t,r){var n;void 0===(n=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMessageForAddonsDescription=function(e,t,r){return e&&t&&r?"Events, Landmarks and Projects":e&&t?"Events and Landmarks":e&&r?"Events and Projects":t&&r?"Landmarks and Projects":e?"Events":t?"Landmarks":r?"Projects":""}}.apply(t,[r,t]))||(e.exports=n)},function(e,t,r){var n;void 0===(n=function(e,t){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.LOAD_FULL_KINGDOM_FROM_URL="LOAD_FULL_KINGDOM_FROM_URL",e.LOAD_PARTIAL_KINGDOM_FROM_URL="LOAD_PARTIAL_KINGDOM_FROM_URL",e.RANDOMIZE_EVENTS_AND_LANDMARKS="RANDOMIZE_EVENTS_AND_LANDMARKS",e.RANDOMIZE_KINGDOM="RANDOMIZE_KINGDOM",e.RANDOMIZE_MULTIPLE="RANDOMIZE_MULTIPLE",e.RANDOMIZE_SINGLE="RANDOMIZE_SINGLE"}(t.EventType||(t.EventType={})),function(e){e.ERROR="error",e.EVENT="event"}(r=t.Category||(t.Category={}));var n=function(){function e(){}return e.trackEvent=function(t){e.attemptToSend(r.EVENT,t)},e.trackError=function(t){e.attemptToSend(r.ERROR,t)},e.attemptToSend=function(e,t){try{ga("send","event",e,t)}catch(r){console.log("Attempted to send event: "+e+": "+t)}},e}();t.EventTracker=n}.apply(t,[r,t]))||(e.exports=n)},function(e,t,r){var n,i,o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};n=[r,t,r(34),r(35),r(36),r(15)],void 0===(i=function(e,t,r,n,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this.count=e}return e.prototype.subdivideDivisions=function(e){for(var t=[],r=this.getRandomizedCountsPerDivision(e),n=0;n<e.length;n++){var o=e[n],s=o.totalCount-r[n];if(s>0){var a=this.getRemainingCards(o),d=new i.SupplyDivision(a,[],[],s);t.push(d)}if(r[n]>0){var u=this.getSatisfyingCards(o),l=new i.SupplyDivision(u,[],[],r[n]);t.push(l)}}return t},e.prototype.getRandomizedCountsPerDivision=function(e){var t,r,n,i,a=this.createRangesForDivisions(e),d=0,u=[];try{for(var l=o(a),c=l.next();!c.done;c=l.next()){var p=c.value.start;u.push(p),d+=p}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}if(d>this.count)throw new Error("Unable to divide division. Too few remaining cards.");var f=this.count-d;if(0==f)return u;var h=this.createSegmentedRangeFromRanges(a);if(h.length<f)throw Error("Unable to divide division. Too few satisfying cards.");var y=s.getRandomInts(f,h.length);try{for(var v=o(y),g=v.next();!g.done;g=v.next()){var S=g.value;u[h.getSegmentForIndex(S)]+=1}}catch(e){n={error:e}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}return u},e.prototype.createRangesForDivisions=function(e){for(var t=this.getSatisfyingCardsPerDivision(e),n=[],i=0;i<t.length;i++){var o=t[i],s=e[i].unfilledCount,a=e[i].availableCards.length-o.length,d=Math.max(s-a,0),u=Math.min(s,o.length);n.push(r.Range.createFromIndices(d,u))}return n},e.prototype.getSatisfyingCardsPerDivision=function(e){var t,r,n=[];try{for(var i=o(e),s=i.next();!s.done;s=i.next()){var a=s.value;n.push(this.getSatisfyingCards(a))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},e.prototype.createSegmentedRangeFromRanges=function(e){var t,r,i=[];try{for(var s=o(e),a=s.next();!a.done;a=s.next()){var d=a.value;i.push(d.length)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return new n.SegmentedRange(0,i)},e}();t.SupplyDivider=a}.apply(t,n))||(e.exports=i)},function(e,t,r){var n;void 0===(n=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.start=e,this.length=t,this.end=e+t}return e.prototype.isInRange=function(e){return this.start<=e&&e<this.end},e.createFromIndices=function(t,r){return new e(t,r-t)},e}();t.Range=r}.apply(t,[r,t]))||(e.exports=n)},function(e,t,r){var n,i,o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});n=[r,t,r(34),r(15)],void 0===(i=function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r){var n=e.call(this,t,r.reduce(function(e,t){return e+t},0))||this;return n.segmentLengths=r,n}return s(t,e),t.prototype.getSegmentForIndex=function(e){for(var t=0,r=0;r<this.segmentLengths.length;r++)if(e<(t+=this.segmentLengths[r]))return r;return-1},t.prototype.getRandomSegmentIndex=function(){var e=n.getRandomInt(0,this.length);return this.getSegmentForIndex(e)},t}(r.Range);t.SegmentedRange=i}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(3)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n){if(this.availableCards=e,this.lockedCards=t,this.selectedCards=r,this.totalCount=n,this.lockedAndSelectedCards=t.concat(r),this.unfilledCount=n-this.lockedAndSelectedCards.length,this.isFilled=this.lockedAndSelectedCards.length>=n,this.lockedAndSelectedCards.length>n)throw new Error("Cannot create a division with more locked and selected cards than the total count.");if(e.length+t.length+r.length<n)throw new Error("Cannot create an unfilled division without enough available cards to fill it.")}return e.prototype.createDivisionByRemovingCards=function(t){var n=this.availableCards.filter(r.Cards.filterByExcludedIds(t)),i=this.selectedCards.filter(r.Cards.filterByExcludedIds(t));return new e(n,this.lockedCards,i,this.totalCount)},e.prototype.createDivisionByLockingCard=function(t){var n=r.Cards.findCardById(this.availableCards,t);if(n)return new e(i=this.availableCards.filter(r.Cards.filterByExcludedIds([t])),this.lockedCards.concat(n),this.selectedCards,this.totalCount);if(n=r.Cards.findCardById(this.selectedCards,t)){var i=this.selectedCards.filter(r.Cards.filterByExcludedIds([t]));return new e(this.availableCards,this.lockedCards.concat(n),i,this.totalCount)}throw new Error("Can't lock card: "+t+". Not found in available or selected cards.")},e.prototype.createDivisionBySelectingCard=function(t){var n=r.Cards.findCardById(this.availableCards,t);if(!n)throw Error("Can't select card: "+t+". Not found in available cards.");return new e(this.availableCards.filter(r.Cards.filterByExcludedIds([t])),this.lockedCards,this.selectedCards.concat(n),this.totalCount)},e.prototype.createDivisionWithTotalCount=function(t){return new e(this.availableCards,this.lockedCards,this.selectedCards,t)},e}();t.SupplyDivision=n}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i,o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};n=[r,t,r(2),r(57),r(8)],void 0===(i=function(e,t,r,n,i){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SET="set",e.ALPHABETICAL="alpha",e.COST="cost"}(s=t.SortOption||(t.SortOption={}));var a=function(){function e(e,t,r){this.selectedSets=ko.observableArray(e),this.sortOption=ko.observable(t),this.randomizerSettings=ko.observable(r)}return e.prototype.toObject=function(){return{sets:e.serializeSets(this.selectedSets()),sortOption:this.sortOption(),randomizerSettings:this.randomizerSettings().toObject()}},e.createFromObject=function(t){return new e(this.deserializeSets(t),this.deserailizeSort(t),n.RandomizerSettings.createFromObject(t.randomizerSettings?t.randomizerSettings:t))},e.serializeSets=function(e){return e.length?e.join(","):i.SetId.BASE_SET},e.deserializeSets=function(e){var t,n;if(e.sets&&"string"==typeof e.sets){var s=e.sets.split(",");if(s.length&&s[0].length){var a=[];try{for(var d=o(s),u=d.next();!u.done;u=d.next()){var l=u.value,c=r.DominionSets.convertToSetIdSafe(l);c&&a.push(c)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=d.return)&&n.call(d)}finally{if(t)throw t.error}}return a}}return[i.SetId.BASE_SET]},e.deserailizeSort=function(e){var t,r;if(e.sortOption){var n=Object.keys(s);try{for(var i=o(n),a=i.next();!a.done;a=i.next()){var d=a.value;if(e.sortOption==s[d])return e.sortOption}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return s.SET}return e.sortAlphabetically?s.ALPHABETICAL:s.SET},e}();t.Settings=a}.apply(t,n))||(e.exports=i)},function(e,t,r){r(39),e.exports=r(60)},function(e,t,r){var n,i;n=[r,t,r(16),r(40)],void 0===(i=function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=new n.IndexPage;i.loadInitialKingdom(),r.initialize(i)}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i,o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};n=[r,t,r(0),r(1),r(3),r(10),r(41),r(42),r(2),r(32),r(32),r(5),r(12),r(6),r(13),r(44),r(13),r(7),r(45),r(46),r(30),r(37),r(31),r(58),r(59)],void 0===(i=function(e,t,r,n,i,o,d,u,l,c,p,f,h,y,v,g,S,C,m,I,b,T,_,A,R){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var w="Dominion card picker for desktop and mobile",O=function(e){function t(){var t=e.call(this,w,v.MenuItem.RANDOMIZER)||this;return t.kingdom=null,t.sets=r.observableArray(t.createSetViewModels()),t.supplyCards=r.observableArray(t.createCardViewModels(10,!0)),t.addons=r.observableArray(t.createCardViewModels(2,!1)),t.isDistributeCostAllowed=t.createIsDistributeCostAllowedObservable(),t.isPrioritizeSetEnabled=r.observable(!1),t.isPrioritizeSetAllowed=t.createIsPrioritizeSetAllowedObservable(),t.isPrioritizeSetAllowed.subscribe(function(){return t.isPrioritizeSetAllowedChanged()}),t.prioritizeSetOptions=t.createPrioritizeSetOptionsObservable(),t.settings=R.loadSettings(),t.randomizerSettings=t.settings.randomizerSettings(),t.initializeSettings(),t.isEnlarged=r.observable(!1),t.metadata=new g.MetadataViewModel,t.dialog=new u.DialogViewModel,t.hasLoaded=r.observable(!1),t.showAddons=t.createShowAddonsObservable(),t.addonsHeader=t.createAddonsHeaderObservable(),t.randomizeButtonText=t.createRandomizeButtonTextObservable(),t}return s(t,e),t.prototype.loadInitialKingdom=function(){this.loadCardBacks();var e=A.deserializeKingdom(location.search);if(e){if(10==e.supply.supplyCards.length)return c.EventTracker.trackEvent(p.EventType.LOAD_FULL_KINGDOM_FROM_URL),void this.setKingdom(e);var t=this.createRandomizerOptionsBuilder().setSetIds(this.getSelectedSetIds()).setExcludeTypes(this.getExcludeTypes()).setIncludeCardIds(i.Cards.extractIds(e.supply.supplyCards)).build(),r=I.Randomizer.createSupplySafe(t);if(r){c.EventTracker.trackEvent(p.EventType.LOAD_PARTIAL_KINGDOM_FROM_URL);var n=new h.Kingdom(r,e.events,e.landmarks,e.projects,e.metadata);return void this.setKingdom(n)}c.EventTracker.trackError(p.EventType.LOAD_PARTIAL_KINGDOM_FROM_URL)}this.randomize()},t.prototype.randomize=function(){var e=this,t=this.getSelectedCards(),r=this.getSelectedEvents().length||this.getSelectedLandmarks().length||this.getSelectedProjects().length||this.getSelectedUndefinedAddons().length;t.length||r?1!=t.length||r?(t.length&&this.randomizeSelectedCards(),r&&this.randomizeSelectedAddons()):this.dialog.open(this.getSelectedSets().map(function(e){return e.setId}),function(){return e.randomizeIndividualSelectedCard()}):this.randomizeFullKingdom()},t.prototype.randomizeFullKingdom=function(){var e=this.getSelectedSetIds();if(e.length){this.supplyCards().forEach(function(e){return e.setToLoading()}),this.addons().forEach(function(e){return e.setToLoading()});var t=this.createRandomizerOptionsBuilder().setSetIds(e).setExcludeCardIds(this.getCardsToExclude()).setExcludeTypes(this.getExcludeTypes()).build();this.dialog.resetOptions();try{this.setKingdom(I.Randomizer.createKingdom(t)),c.EventTracker.trackEvent(p.EventType.RANDOMIZE_KINGDOM)}catch(e){c.EventTracker.trackError(p.EventType.RANDOMIZE_KINGDOM)}this.saveSettings()}},t.prototype.randomizeSelectedCards=function(){var e=this.createRandomizerOptionsBuilder().setSetIds(this.getSelectedSetIds()).setIncludeCardIds(this.extractCardIds(this.getUnselectedCards())).setExcludeCardIds(this.extractCardIds(this.getSelectedCards())).setExcludeTypes(this.getExcludeTypes()).build(),t=I.Randomizer.createSupplySafe(e);t?(c.EventTracker.trackEvent(p.EventType.RANDOMIZE_MULTIPLE),this.replaceSelectedCardsWithSupply(t)):c.EventTracker.trackError(p.EventType.RANDOMIZE_MULTIPLE)},t.prototype.randomizeSelectedAddons=function(){var e=this.getSelectedEvents().concat(this.getSelectedLandmarks(),this.getSelectedProjects()),t=e.length+this.getSelectedUndefinedAddons().length,r=this.getSelectedSetIds(),n=this.extractCardIds(e),i=I.Randomizer.getRandomAddons(r,n,t);this.replaceSelectedAddons(i),c.EventTracker.trackEvent(p.EventType.RANDOMIZE_EVENTS_AND_LANDMARKS)},t.prototype.randomizeIndividualSelectedCard=function(){var e=[];this.dialog.selectedType()&&!this.randomizerSettings.allowAttacks()&&e.push(o.CardType.ATTACK);var t=this.dialog.selectedSetId()==u.DialogViewModel.ALL_OPTION_ID?this.getSelectedSetIds():[this.dialog.selectedSetId()],r=(new m.RandomizerOptionsBuilder).setSetIds(t).setIncludeCardIds(this.extractCardIds(this.getUnselectedCards())).setExcludeCardIds(this.extractCardIds(this.getSelectedCards())).setExcludeTypes(e).setExcludeCosts(this.dialog.costs.filter(function(e){return!e.isActive()}).map(function(e){return e.id}));this.dialog.selectedType()!=u.DialogViewModel.ALL_OPTION_ID?r.setRequireSingleCardOfType(this.dialog.selectedType()):r.setRequireActionProvider(this.randomizerSettings.requireActionProvider()).setRequireCardProvider(this.randomizerSettings.requireCardProvider()).setRequireBuyProvider(this.randomizerSettings.requireBuyProvider()).setRequireTrashing(this.randomizerSettings.requireTrashing()).setRequireReactionIfAttacks(this.randomizerSettings.requireReaction());var n=I.Randomizer.createSupplySafe(r.build());n?(c.EventTracker.trackEvent(p.EventType.RANDOMIZE_SINGLE),this.replaceSelectedCardsWithSupply(n)):c.EventTracker.trackError(p.EventType.RANDOMIZE_SINGLE)},t.prototype.replaceSelectedCardsWithSupply=function(e){var t,r,n=this,i=this.getSelectedCards(),o=this.extractCardIds(this.getUnselectedCards());i.forEach(function(e){return e.setToLoading()}),this.kingdom=new h.Kingdom(e,this.kingdom.events,this.kingdom.landmarks,this.kingdom.projects,this.kingdom.metadata),this.updateUrlForKingdom(this.kingdom);var s=i.length,u=function(){--s<=0&&setTimeout(function(){return n.sortCards()},d.CardViewModel.ANIMATION_TIME)},l=function(e,t){if(e.setCard(t),e.isCardImageLoaded())u();else var r=e.isCardImageLoaded.subscribe(function(e){e&&(r.dispose(),u())})},c=0;try{for(var p=a(this.kingdom.supply.supplyCards),f=p.next();!f.done;f=p.next()){var y=f.value;-1==o.indexOf(y.id)&&c<i.length&&l(i[c++],y)}}catch(e){t={error:e}}finally{try{f&&!f.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}},t.prototype.replaceSelectedAddons=function(e){var t,r,n=this.getSelectedEvents(),i=this.getSelectedLandmarks(),o=this.getSelectedProjects(),s=this.getSelectedUndefinedAddons(),d=n.concat(i,o,s);d.forEach(function(e){return e.setToLoading()});var u=this.addons().filter(function(e){return!e.isSelected()}).map(function(e){return e.id()}),l=0;try{for(var c=a(e),p=c.next();!p.done;p=c.next()){var f=p.value;-1==u.indexOf(f.id)&&l<d.length&&d[l++].setCard(f)}}catch(e){t={error:e}}finally{try{p&&!p.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}},t.prototype.setKingdom=function(e){var t=this;this.kingdom=e;for(var r=this.supplyCards(),n=this.kingdom.supply.supplyCards.concat().sort(function(e,r){return t.supplyCardSorter(e,r)}),i=0;i<n.length;i++)r[i].setCard(n[i]);var o=this.addons(),s=this.kingdom.events.concat(this.kingdom.landmarks,this.kingdom.projects);for(i=0;i<o.length;i++)i<s.length?o[i].setCard(s[i]):o[i].setToLoading();this.metadata.update(e.metadata),this.updateUrlForKingdom(e)},t.prototype.toggleEnlarged=function(){this.isEnlarged(!this.isEnlarged())},t.prototype.createSetViewModels=function(){return l.DominionSets.getAllSets().concat().sort(function(e,t){return e.name==t.name?0:e.name<t.name?-1:1}).map(function(e){return new b.SetViewModel(e,!1)})},t.prototype.createShowAddonsObservable=function(){var e=this;return r.pureComputed(function(){var t,r,n,i;if(!e.hasLoaded())return!1;try{for(var o=a(e.sets()),s=o.next();!s.done;s=o.next()){var d=s.value;if(d.isActive()){var u=l.DominionSets.getSetById(d.setId);if(u.events.length||u.landmarks.length||u.projects.length)return!0}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}try{for(var c=a(e.addons()),p=c.next();!p.done;p=c.next()){if(!p.value.isLoading())return!0}}catch(e){n={error:e}}finally{try{p&&!p.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}return!1})},t.prototype.createAddonsHeaderObservable=function(){var e=this;return r.pureComputed(function(){var t,r,n,i,o=!1,s=!1,d=!1;try{for(var u=a(e.sets()),c=u.next();!c.done;c=u.next()){var p=c.value;if(p.isActive()){var h=l.DominionSets.getSetById(p.setId);o=o||h.events.length>0,s=s||h.landmarks.length>0,d=d||h.projects.length>0}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}try{for(var v=a(e.addons()),g=v.next();!g.done;g=v.next()){var S=g.value;if(S.id()){var m=l.DominionSets.getCardById(S.id());o=o||m instanceof f.Event,s=s||m instanceof y.Landmark,d=d||m instanceof C.Project}}}catch(e){n={error:e}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}return _.getMessageForAddonsDescription(o,s,d)})},t.prototype.createRandomizeButtonTextObservable=function(){var e=this;return r.pureComputed(function(){return e.supplyCards().concat(e.addons()).some(function(e){return e.isSelected()})?"Replace!":"Randomize!"})},t.prototype.createIsDistributeCostAllowedObservable=function(){var e=this;return r.pureComputed(function(){var t,r,n=0,i=e.getSelectedSetIds();try{for(var o=a(i),s=o.next();!s.done;s=o.next()){var d=s.value;n+=l.DominionSets.getSetById(d).supplyCards.length}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return n>=24})},t.prototype.createIsPrioritizeSetAllowedObservable=function(){var e=this;return r.pureComputed(function(){return e.getSelectedSetIds().length>=3})},t.prototype.createPrioritizeSetOptionsObservable=function(){var e=this;return r.pureComputed(function(){return e.sets().filter(function(e){return e.isActive()}).map(function(e){return{name:e.name,value:e.setId}})})},t.prototype.createCardViewModels=function(e,t){for(var r=[],n=0;n<e;n++)r.push(new d.CardViewModel(this,t));return r},t.prototype.createRandomizerOptionsBuilder=function(){return(new m.RandomizerOptionsBuilder).setRequireActionProvider(this.randomizerSettings.requireActionProvider()).setRequireBuyProvider(this.randomizerSettings.requireBuyProvider()).setRequireTrashing(this.randomizerSettings.requireTrashing()).setRequireReactionIfAttacks(this.randomizerSettings.requireReaction()).setDistributeCost(this.isDistributeCostAllowed()&&this.randomizerSettings.distributeCost()).setPrioritizeSet(this.isPrioritizeSetAllowed()&&this.isPrioritizeSetEnabled()?this.randomizerSettings.prioritizeSet():null)},t.prototype.initializeSettings=function(){var e,t,r=this,n=function(){r.saveSettings()},i=this.settings.selectedSets();try{for(var o=a(this.sets()),s=o.next();!s.done;s=o.next()){var d=s.value;d.isActive(-1!=i.indexOf(d.setId)),d.isActive.subscribe(n)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}this.isPrioritizeSetEnabled(!!this.randomizerSettings.prioritizeSet()),this.isPrioritizeSetEnabled.subscribe(function(){return r.isPrioritizeSetEnabledChanged()}),this.settings.sortOption.subscribe(function(){return r.sortCards()}),this.settings.sortOption.subscribe(n),this.randomizerSettings.requireActionProvider.subscribe(n),this.randomizerSettings.requireBuyProvider.subscribe(n),this.randomizerSettings.allowAttacks.subscribe(n),this.randomizerSettings.requireReaction.subscribe(n),this.randomizerSettings.requireTrashing.subscribe(n),this.randomizerSettings.distributeCost.subscribe(n),this.randomizerSettings.prioritizeSet.subscribe(n)},t.prototype.saveSettings=function(){var e=this.getSelectedSetIds();this.settings.selectedSets(e),R.saveSettings(this.settings)},t.prototype.isPrioritizeSetAllowedChanged=function(){this.isPrioritizeSetAllowed()||this.randomizerSettings.prioritizeSet(null)},t.prototype.isPrioritizeSetEnabledChanged=function(){this.isPrioritizeSetEnabled()||this.randomizerSettings.prioritizeSet(null)},t.prototype.getCardsToExclude=function(){return this.randomizerSettings.prioritizeSet()?[]:this.getSelectedSetIds().length<3?[]:this.extractCardIds(this.supplyCards())},t.prototype.getExcludeTypes=function(){return this.randomizerSettings.allowAttacks()?[]:[o.CardType.ATTACK]},t.prototype.extractCardIds=function(e){return e.map(function(e){return e.id()})},t.prototype.getSelectedSetIds=function(){return this.getSelectedSets().map(function(e){return e.setId})},t.prototype.getSelectedSets=function(){return this.sets().filter(function(e){return e.isActive()})},t.prototype.getSelectedCards=function(){return this.supplyCards().filter(function(e){return e.isSelected()})},t.prototype.getUnselectedCards=function(){return this.supplyCards().filter(function(e){return!e.isSelected()})},t.prototype.getSelectedEvents=function(){return this.getSelectedAddons(f.Event)},t.prototype.getSelectedLandmarks=function(){return this.getSelectedAddons(y.Landmark)},t.prototype.getSelectedProjects=function(){return this.getSelectedAddons(C.Project)},t.prototype.getSelectedAddons=function(e){var t,r,n=[];try{for(var i=a(this.addons()),o=i.next();!o.done;o=i.next()){var s=o.value;if(s.id()&&s.isSelected())l.DominionSets.getCardById(s.id())instanceof e&&n.push(s)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},t.prototype.getSelectedUndefinedAddons=function(){var e,t,r=[];try{for(var n=a(this.addons()),i=n.next();!i.done;i=n.next()){var o=i.value;o.isLoading()&&o.isSelected()&&r.push(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return r},t.prototype.updateUrlForKingdom=function(e){var t=new URL(location.href);t.search=A.serializeKingdom(e),history.replaceState({},"",t.href)},t.prototype.loadCardBacks=function(){var e=this,t=Date.now(),r=2,i=function(){if(!(--r<=0)){var n=500-(Date.now()-t);n>0?setTimeout(function(){return e.hasLoaded(!0)},n):e.hasLoaded(!0)}};n.imgpreload(d.CardViewModel.VERTICAL_LOADING_IMAGE_URL,i),n.imgpreload(d.CardViewModel.HORIZONTAL_LOADING_IMAGE_URL,i)},t.prototype.sortCards=function(){for(var e=this,r=this.isEnlarged()&&this.isCondensed(),i=n("body"),o=this.supplyCards(),s=n("#cards").find(".card-wrap .card-front"),a=[],d=0;d<o.length;d++)a.push({card:o[d],element:n(s[d])});a.sort(function(t,r){return e.descriptorSorter(t,r)});var u=[];for(d=0;d<a.length;d++)for(var l=a[d],c=0;c<o.length;c++){o[c]==l.card&&d!=c&&(l.moveFrom=l.element.offset(),l.moveTo=n(s[d]).offset(),u.push(l))}var p=function(e){var o=u[e],s=o.element.clone(!1),a=o.moveTo.left-o.moveFrom.left,d=o.moveTo.top-o.moveFrom.top;r&&s.addClass("enlarge-cards");var l={position:"absolute",height:o.element.height(),width:o.element.width(),top:o.moveFrom.top,left:o.moveFrom.left,"transition-property":"-webkit-transform, -webkit-filter, -moz-transform, -moz-filter, opacity"};t.addVenderPrefixes(l,"transition-timing-function","ease-in-out"),t.addVenderPrefixes(l,"transition-duration","600ms"),t.addVenderPrefixes(l,"transition-delay",0),t.addVenderPrefixes(l,"filter","none"),t.addVenderPrefixes(l,"transition","transform 600ms ease-in-out"),t.addVenderPrefixes(l,"transform","translate(0px,0px)"),s.appendTo(i),s.css(l);var c=n([o.element.get(0),o.element.siblings(".card-back").get(0)]);c.css("visibility","hidden");var p=function(){c.css("visibility","visible"),s.remove()};s.bind("webkitTransitionEnd transitionend otransitionend oTransitionEnd",p),setTimeout(p,610),setTimeout(function(){s.css("transform","translate("+a+"px,"+d+"px)")},0)};for(d=0;d<u.length;d++)p(d);this.supplyCards.sort(function(t,r){return e.cardSorter(t,r)})},t.prototype.descriptorSorter=function(e,t){return this.cardSorter(e.card,t.card)},t.prototype.cardSorter=function(e,t){return this.supplyCardSorter(l.DominionSets.getSupplyCardById(e.id()),l.DominionSets.getSupplyCardById(t.id()))},t.prototype.supplyCardSorter=function(e,r){if(this.settings.sortOption()==T.SortOption.SET&&e.setId!=r.setId)return e.setId<r.setId?-1:1;if(this.settings.sortOption()==T.SortOption.COST){var n=t.compareCosts(e,r);if(0!=n)return n}return e.name==r.name?0:e.name<r.name?-1:1},t.compareCosts=function(e,t){var r=this.getCostSum(e),n=this.getCostSum(t);return r==n?0:r<n?-1:1},t.getCostSum=function(e){return e.cost.treasure+.9*e.cost.potion+e.cost.debt},t.addVenderPrefixes=function(e,t,r){return e["-webkit-"+t]=r,e["-moz-"+t]=r,e[t]=r,e},t}(S.Page);t.IndexPage=O}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(0),r(1),r(2)],void 0===(i=function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){var n=this;this.parent=e,this.isVertical=t,this.id=r.observable(null),this.setId=r.observable(null),this.name=r.observable(null),this.setName=r.observable(null),this.isLoading=r.observable(!0),this.isCardImageLoaded=r.observable(!1),this.isSelected=r.observable(!1),this.animationStartTime=null,this.cardIdBeingLoaded=null,this.imageUrl=r.observable(this.getLoadingImageUrl()),this.setClass=r.pureComputed(function(){return n.isLoading()?"loading":n.setId()})}return e.prototype.setCard=function(t){var r=this;this.cardIdBeingLoaded=t.id;var i="/img/cards/"+t.id+".jpg";this.isCardImageLoaded(!1),n.imgpreload(i,function(){var n=r.animationStartTime||0,o=e.ANIMATION_TIME-(Date.now()-n);o>=0?setTimeout(function(){return r.setCardInternal(t,i)},o):r.setCardInternal(t,i)})},e.prototype.setCardInternal=function(e,t){e.id==this.cardIdBeingLoaded&&(this.id(e.id),this.name(e.name),this.setId(e.setId),this.setName(i.DominionSets.getSetById(e.setId).name),this.imageUrl(t),this.isLoading(!1),this.isCardImageLoaded(!0))},e.prototype.setToLoading=function(){this.isSelected(!1),this.isLoading(!0),this.animationStartTime=Date.now()},e.prototype.toggleSelected=function(){this.isSelected(!this.isSelected())},e.prototype.getLoadingImageUrl=function(){return this.isVertical?e.VERTICAL_LOADING_IMAGE_URL:e.HORIZONTAL_LOADING_IMAGE_URL},e.ANIMATION_TIME=600,e.VERTICAL_LOADING_IMAGE_URL="/img/cards/backside_blue.jpg",e.HORIZONTAL_LOADING_IMAGE_URL="/img/cards/backside_blue_horizontal.jpg",e}();t.CardViewModel=o}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i,o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};n=[r,t,r(0),r(43),r(10),r(14),r(2)],void 0===(i=function(e,t,r,n,i,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=function(e,t){this.id=e,this.name=t,this.isActive=r.observable(!0)},u=function(){function e(){this.sets=r.observableArray(),this.selectedSetId=r.observable(e.ALL_OPTION_ID),this.supplyCardTypes=this.createSupplyCardTypes(),this.selectedType=r.observable(e.ALL_OPTION_ID),this.costs=this.createCosts(),this.isSetsSectionOpen=r.observable(!1),this.isSupplyCardTypesSectionOpen=r.observable(!1),this.isCostsSectionOpen=r.observable(!1),this.vexDialogId=null,this.callback=null}return e.prototype.toggleSetsSection=function(){this.isSetsSectionOpen(!this.isSetsSectionOpen())},e.prototype.toggleSupplyCardTypesSection=function(){this.isSupplyCardTypesSectionOpen(!this.isSupplyCardTypesSectionOpen())},e.prototype.toggleCostsSection=function(){this.isCostsSectionOpen(!this.isCostsSectionOpen())},e.prototype.fetchNewCards=function(){this.callback&&this.callback(),this.close()},e.prototype.open=function(e,t){var r=this;this.callback=t,this.sets(this.createSets(e)),this.checkSelectedSetState();var i=null,o={afterOpen:function(e){i=$(".dialog-hidden-content .dialog-content").first().detach(),e.append(i)},beforeClose:function(){i.detach().appendTo($(".dialog-hidden-content"))},afterClose:function(){r.vexDialogId=null},className:"vex-theme-os"},s=n.open(o);this.vexDialogId=s.data().vex.id},e.prototype.resetOptions=function(){var t,r;this.selectedSetId(e.ALL_OPTION_ID),this.selectedType(e.ALL_OPTION_ID);try{for(var n=o(this.costs),i=n.next();!i.done;i=n.next()){i.value.isActive(!0)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.close=function(){this.vexDialogId&&(n.close(this.vexDialogId),this.callback=null)},e.prototype.createSets=function(t){var r,n,i=[new d(e.ALL_OPTION_ID,"Any")];try{for(var s=o(t),u=s.next();!u.done;u=s.next()){var l=u.value,c=a.DominionSets.getSetById(l);i.push(new d(c.setId,c.name))}}catch(e){r={error:e}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i},e.prototype.checkSelectedSetState=function(){var t,r,n=this.selectedSetId(),i=this.sets();try{for(var s=o(i),a=s.next();!a.done;a=s.next()){if(a.value.id==n)return}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}this.selectedSetId(e.ALL_OPTION_ID)},e.prototype.createSupplyCardTypes=function(){return[new d(e.ALL_OPTION_ID,"Any"),new d(i.CardType.DRAWER,"+ Cards"),new d(i.CardType.BUY_SUPPLIER,"+1 Buy"),new d(i.CardType.ACTION_SUPPLIER,"+2 Actions"),new d(i.CardType.ACTION,"Action"),new d(i.CardType.ATTACK,"Attack"),new d(i.CardType.DURATION,"Duration"),new d(i.CardType.REACTION,"Reaction"),new d(i.CardType.RESERVE,"Reserve"),new d(i.CardType.TRASHING,"Trashing"),new d(i.CardType.TREASURE,"Treasure"),new d(i.CardType.VICTORY,"Victory")]},e.prototype.createCosts=function(){return[new d(s.CostType.TREASURE_2_OR_LESS,"1-2"),new d(s.CostType.TREASURE_3,"3"),new d(s.CostType.TREASURE_4,"4"),new d(s.CostType.TREASURE_5,"5"),new d(s.CostType.TREASURE_6,"6"),new d(s.CostType.TREASURE_7,"7"),new d(s.CostType.TREASURE_8_OR_MORE,"8+")]},e.ALL_OPTION_ID="all",e}();t.DialogViewModel=u}.apply(t,n))||(e.exports=i)},function(e,t){e.exports=vex},function(e,t,r){var n,i;n=[r,t,r(0)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){var e=this;this.useColonies=r.observable(!1),this.useShelters=r.observable(!1),this.show=r.computed(function(){return e.useColonies()||e.useShelters()})}return e.prototype.update=function(e){this.useColonies(e.useColonies),this.useShelters(e.useShelters)},e}();t.MetadataViewModel=n}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(8)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,r,n,i,o,s,a,d,u,l,c,p){this.setIds=e,this.includeCardIds=t,this.excludeCardIds=r,this.requireSingleCardOfType=n,this.excludeTypes=i,this.excludeCosts=o,this.requireActionProvider=s,this.requireCardProvider=a,this.requireBuyProvider=d,this.requireReactionIfAttacks=u,this.requireTrashing=l,this.distributeCost=c,this.prioritizeSet=p};t.RandomizerOptions=n;var i=function(){function e(){this.setIds=[r.SetId.BASE_SET],this.includeCardIds=[],this.excludeCardIds=[],this.requireSingleCardOfType=null,this.excludeTypes=[],this.excludeCosts=[],this.requireActionProvider=!0,this.requireCardProvider=!1,this.requireBuyProvider=!1,this.requireReactionIfAttacks=!1,this.requireTrashing=!1,this.distributeCost=!1,this.prioritizeSet=null}return e.prototype.setSetIds=function(e){return this.setIds=e,this},e.prototype.setIncludeCardIds=function(e){return this.includeCardIds=e,this},e.prototype.setExcludeCardIds=function(e){return this.excludeCardIds=e,this},e.prototype.setRequireSingleCardOfType=function(e){return this.requireSingleCardOfType=e,this},e.prototype.setExcludeTypes=function(e){return this.excludeTypes=e,this},e.prototype.setExcludeCosts=function(e){return this.excludeCosts=e,this},e.prototype.setRequireActionProvider=function(e){return this.requireActionProvider=e,this},e.prototype.setRequireCardProvider=function(e){return this.requireCardProvider=e,this},e.prototype.setRequireBuyProvider=function(e){return this.requireBuyProvider=e,this},e.prototype.setRequireReactionIfAttacks=function(e){return this.requireReactionIfAttacks=e,this},e.prototype.setRequireTrashing=function(e){return this.requireTrashing=e,this},e.prototype.setDistributeCost=function(e){return this.distributeCost=e,this},e.prototype.setPrioritizeSet=function(e){return this.prioritizeSet=e,this},e.prototype.build=function(){return new n(this.setIds,this.includeCardIds,this.excludeCardIds,this.requireSingleCardOfType,this.excludeTypes,this.excludeCosts,this.requireActionProvider,this.requireCardProvider,this.requireBuyProvider,this.requireReactionIfAttacks,this.requireTrashing,this.distributeCost,this.prioritizeSet)},e}();t.RandomizerOptionsBuilder=i}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i,o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};n=[r,t,r(47),r(48),r(49),r(10),r(3),r(2),r(5),r(12),r(6),r(12),r(29),r(7),r(8),r(50),r(51),r(29),r(52),r(53),r(54),r(55),r(15)],void 0===(i=function(e,t,r,n,i,s,a,d,u,l,c,p,f,h,y,v,g,S,C,m,I,b,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _={baseset2:"baseset",intrigue2:"intrigue"},A=function(){function e(){}return e.createKingdom=function(e){var t=this.createSupplyWithRetries(e),r=this.getAddons(e.setIds),n=this.getMetadata(e.setIds);return new l.Kingdom(t,r.events,r.landmarks,r.projects,n)},e.createSupplySafe=function(e){try{return this.createSupplyWithRetries(e)}catch(e){return console.log("Failed to create supply: \n"+e.toString()),null}},e.createSupplyWithRetries=function(e){for(var t=3;t>0;)try{return this.createSupply(e)}catch(e){console.log("Error when trying to select cards: \n"+e.toString()),t-=1}throw new Error("Failed to select cards that satisfied all requirements.")},e.createSupply=function(e){var t=a.Cards.getAllSupplyCards(a.Cards.getAllCardsFromSets(d.DominionSets.getAllSets())),o=this.removeDuplicateCards(t.filter(a.Cards.filterByIncludedSetIds(e.setIds)),[]),u=new C.SupplyBuilder(o);e.excludeCardIds.length&&u.addBan(new r.CardSupplyBan(e.excludeCardIds)),e.excludeTypes.length&&u.addBan(new I.TypeSupplyBan(e.excludeTypes)),e.excludeCosts.length&&u.addBan(new n.CostSupplyBan(e.excludeCosts)),e.requireSingleCardOfType&&u.addRequirement(new b.TypeSupplyRequirement(e.requireSingleCardOfType,!0)),e.requireActionProvider&&u.addRequirement(new b.TypeSupplyRequirement(s.CardType.ACTION_SUPPLIER,!1)),e.requireCardProvider&&u.addRequirement(new b.TypeSupplyRequirement(s.CardType.MULTI_DRAWER,!1)),e.requireBuyProvider&&u.addRequirement(new b.TypeSupplyRequirement(s.CardType.BUY_SUPPLIER,!1)),e.requireTrashing&&u.addRequirement(new b.TypeSupplyRequirement(s.CardType.TRASHING,!1));var l=10;e.prioritizeSet&&e.prioritizeSet!=y.SetId.ALCHEMY&&(u.addDivider(new g.SetSupplyDivider(e.prioritizeSet,5)),l-=5);var c=0;this.shouldUseAlchemyDivider(e)?(c=this.getNumberOfAlchemyCardsToUse(e,l),u.addDivider(new g.SetSupplyDivider(y.SetId.ALCHEMY,c)),l-=c):e.setIds.length>1&&u.addBan(new v.SetSupplyBan([y.SetId.ALCHEMY]));var p=-1;e.distributeCost&&(p=T.getRandomInt(3,5),u.addDivider(new i.CostSupplyDivider(5,p)));var h=e.includeCardIds.map(function(e){return d.DominionSets.getSupplyCardById(e)}),m=this.createSupplyCardsWithRetries(u,h);if(e.requireReactionIfAttacks){var _=this.correctSupplyBuilderForRequiredReaction(u,h,m);_&&(u=_,m=this.createSupplyCardsWithRetries(u,h))}var A=new f.Metadata(u,e.prioritizeSet,c,p);return new S.Supply(m,A)},e.getAddons=function(e){var t,r,n=a.Cards.filterSetsByAllowedSetIds(d.DominionSets.getAllSets(),e),i=a.Cards.getAllCardsFromSets(n),s=this.selectRandomCards(i,10),l=[],p=[],f=[];try{for(var y=o(s),v=y.next();!v.done;v=y.next()){var g=v.value;if(g instanceof u.Event?l.push(g):g instanceof c.Landmark?p.push(g):g instanceof h.Project&&f.push(g),l.length+p.length+f.length>=2)break}}catch(e){t={error:e}}finally{try{v&&!v.done&&(r=y.return)&&r.call(y)}finally{if(t)throw t.error}}return{events:l,landmarks:p,projects:f}},e.getRandomAddons=function(e,t,r){var n=this.getAddonsFromSets(e,t);return this.selectRandomCards(n,r)},e.getAddonsFromSets=function(e,t){var r=a.Cards.filterSetsByAllowedSetIds(d.DominionSets.getAllSets(),e),n=a.Cards.getAllCardsFromSets(r).filter(a.Cards.filterByExcludedIds(t)),i=a.Cards.getAllEvents(n),o=a.Cards.getAllLandmarks(n),s=a.Cards.getAllProjects(n);return i.concat(o,s)},e.getMetadata=function(e){var t=a.Cards.filterSetsByAllowedSetIds(d.DominionSets.getAllSets(),e),r=this.shouldUseSpecialtyCardFromSet(y.SetId.PROSPERITY,t),n=this.shouldUseSpecialtyCardFromSet(y.SetId.DARK_AGES,t);return new p.Metadata(r,n)},e.shouldUseSpecialtyCardFromSet=function(e,t){var r,n,i=t.map(function(e){return e.setId}).indexOf(e);if(-1==i)return!1;var s=t[i].supplyCards.length,a=0;try{for(var d=o(t),u=d.next();!u.done;u=d.next()){a+=u.value.supplyCards.length}}catch(e){r={error:e}}finally{try{u&&!u.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}return T.getRandomInt(0,a)<s},e.selectRandomCards=function(e,t){var r,n,i=T.getRandomInts(t,e.length),s=[];try{for(var a=o(i),d=a.next();!d.done;d=a.next()){var u=d.value;s.push(e[u])}}catch(e){r={error:e}}finally{try{d&&!d.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return s},e.shouldUseAlchemyDivider=function(e){return 1!=e.setIds.length&&(e.prioritizeSet==y.SetId.ALCHEMY||-1!=e.setIds.indexOf(y.SetId.ALCHEMY)&&(e.setIds.length<3||!T.getRandomInt(0,e.setIds.length)))},e.correctSupplyBuilderForRequiredReaction=function(e,t,r){if(r.filter(a.Cards.filterByRequiredType(s.CardType.REACTION)).length)return null;if(!r.filter(a.Cards.filterByRequiredType(s.CardType.ATTACK)).length)return null;var n=(e=e.clone()).createUnfilledDivisions(t);return m.SupplyDivisions.getAvailableCardsOfType(n,s.CardType.REACTION).length?(e.addRequirement(new b.TypeSupplyRequirement(s.CardType.REACTION,!1)),e):(e.addBan(new I.TypeSupplyBan([s.CardType.ATTACK])),e)},e.createSupplyCardsWithRetries=function(e,t){for(var r=3;r>0;)try{return e.createSupply(t)}catch(e){console.log("Error when trying to select cards: \n"+e.toString()),r-=1}throw new Error("Failed to select cards that satisfied all requirements.")},e.getNumberOfAlchemyCardsToUse=function(e,t){var r=3,n=5;return e.prioritizeSet==y.SetId.ALCHEMY&&(r=Math.max(r,5),n=Math.max(n,5)),T.getRandomInt(r,Math.min(n,t))},e.removeDuplicateCards=function(e,t){var r,n,i=Object.keys(_);try{for(var s=o(i),d=s.next();!d.done;d=s.next()){var u=d.value,l=u,c=_[u],p=e.filter(a.Cards.filterByIncludedSetIds([l])),f=e.filter(a.Cards.filterByIncludedSetIds([c])),h=this.replaceSetIdForCards(p,c),y=f.filter(a.Cards.filterByIncludedIds(t)),v=this.removeIds(h,a.Cards.extractIds(y)),g=this.removeIds(a.Cards.extractIds(f),v),S=this.replaceSetIdForCards(y,l),C=this.removeIds(a.Cards.extractIds(p),S),m=this.removeIds(a.Cards.extractIds(p),C),I=this.removeIds(a.Cards.extractIds(f),g);e=(e=e.filter(a.Cards.filterByExcludedIds(m))).filter(a.Cards.filterByExcludedIds(I))}}catch(e){r={error:e}}finally{try{d&&!d.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return e},e.removeIds=function(e,t){return e.filter(function(e){return-1==t.indexOf(e)})},e.replaceSetIdForCards=function(e,t){var r,n,i=[];try{for(var s=o(e),a=s.next();!a.done;a=s.next()){var d=a.value;i.push(this.replaceSetIdInCardId(d.id,t))}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i},e.replaceSetIdInCardId=function(e,t){return t+"_"+e.split("_")[1]},e}();t.Randomizer=A}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(3)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.cardIds=e}return e.prototype.getBannedCards=function(e){return e.filter(r.Cards.filterByIncludedIds(this.cardIds))},e}();t.CardSupplyBan=n}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(3)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.costTypes=e}return e.prototype.getBannedCards=function(e){return e.filter(r.Cards.filterByAllowedCosts(this.costTypes))},e}();t.CostSupplyBan=n}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i,o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});n=[r,t,r(33)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(t,r){var n=e.call(this,r)||this;return n.highCostCutOff=t,n}return s(t,e),t.prototype.getSatisfyingCards=function(e){var t=this;return e.availableCards.filter(function(e){return t.isSatisfyingCard(e)})},t.prototype.getRemainingCards=function(e){var t=this;return e.availableCards.filter(function(e){return t.isRemainingCard(e)})},t.prototype.isSatisfyingCard=function(e){return this.getCost(e)>=this.highCostCutOff},t.prototype.isRemainingCard=function(e){return this.getCost(e)<this.highCostCutOff},t.prototype.getCost=function(e){return 1*e.cost.debt+2*e.cost.potion+1*e.cost.treasure},t}(r.SupplyDivider);t.CostSupplyDivider=n}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(3)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.setIds=e}return e.prototype.getBannedCards=function(e){return e.filter(r.Cards.filterByIncludedSetIds(this.setIds))},e}();t.SetSupplyBan=n}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i,o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});n=[r,t,r(3),r(33)],void 0===(i=function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.setId=t,n}return s(t,e),t.prototype.getSatisfyingCards=function(e){return e.availableCards.filter(r.Cards.filterByIncludedSetIds([this.setId]))},t.prototype.getRemainingCards=function(e){return e.availableCards.filter(r.Cards.filterByExcludedSetIds([this.setId]))},t}(n.SupplyDivider);t.SetSupplyDivider=i}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i,o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};n=[r,t,r(3),r(35),r(36),r(15)],void 0===(i=function(e,t,r,n,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this.cards=e,this.dividers=[],this.requirements=[],this.bans=[],this.corrections=[]}return e.prototype.addDivider=function(e){this.dividers.push(e)},e.prototype.addRequirement=function(e){this.requirements.push(e)},e.prototype.addBan=function(e){this.bans.push(e)},e.prototype.addCorrection=function(e){this.corrections.push(e)},e.prototype.createUnfilledDivisions=function(e){var t=new i.SupplyDivision(this.cards,[],[],10);t=this.prepareDivisionForBanning(t,e),t=this.applyBans(t),t=this.addExistingCardsAsAvailable(t,e);var r=this.applyDividers([t]);return r=this.applyExistingCards(r,e)},e.prototype.createSupply=function(e){var t=this.createUnfilledDivisions(e);return t=this.applyRequirements(t),t=this.applyCorrections(t),t=this.fillDivisions(t),this.gatherCards(t)},e.prototype.clone=function(){var t=new e(this.cards);return t.dividers=this.dividers,t.requirements=this.requirements,t.bans=this.bans,t.corrections=this.corrections,t},e.prototype.prepareDivisionForBanning=function(e,t){return e.createDivisionWithTotalCount(e.totalCount-t.length)},e.prototype.applyBans=function(e){var t,n;try{for(var i=o(this.bans),s=i.next();!s.done;s=i.next()){var a=s.value.getBannedCards(e.availableCards);e=e.createDivisionByRemovingCards(r.Cards.extractIds(a))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return e},e.prototype.applyRequirements=function(e){var t,r;e=e.concat();var n=this.orderRequirementsForDivisions(e);try{for(var i=o(n),a=i.next();!a.done;a=i.next()){var d=a.value;if(!d.isSatisfied(e)){var u=this.getSegmentedRangeForRequirement(d,e);if(!u.length)throw new Error("Unable to satisfy requirement: "+d+".");for(var l=u.getRandomSegmentIndex(),c=d.getSatisfyingCardsFromDivisions([e[l]]);c.length;){var p=s.getRandomInt(0,c.length),f=c[p];if(this.allowLockedCard(e,f)){e[l]=e[l].createDivisionByLockingCard(f.id);break}c.splice(p,1)}if(!c.length)throw new Error("Unable to satisfy requirement: "+d+".")}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return e},e.prototype.applyDividers=function(e){var t,r;try{for(var n=o(this.dividers),i=n.next();!i.done;i=n.next()){e=i.value.subdivideDivisions(e)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return e},e.prototype.addExistingCardsAsAvailable=function(e,t){var n,s,a=r.Cards.extractIds(e.availableCards),d=[];try{for(var u=o(t),l=u.next();!l.done;l=u.next()){var c=l.value;-1==a.indexOf(c.id)&&d.push(c)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(s=u.return)&&s.call(u)}finally{if(n)throw n.error}}return new i.SupplyDivision(e.availableCards.concat(d),e.lockedCards,e.selectedCards,e.totalCount+t.length)},e.prototype.applyExistingCards=function(e,t){var r,n;e=e.concat();var s=[];try{for(var a=o(t),d=a.next();!d.done;d=a.next()){var u=d.value;if(-1==(p=this.findIndexOfDivisionContainingCardId(e,u.id)))s.push(u);else{var l=e[p];e[p]=l.createDivisionByLockingCard(u.id)}}}catch(e){r={error:e}}finally{try{d&&!d.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}if(!s.length)return e;for(var c=0;c<s.length;c++){var p;l=e[p=this.getIndexOfDivisionWithMostUnfilledCards(e)];e[p]=new i.SupplyDivision(l.availableCards,l.lockedCards,l.selectedCards,l.totalCount-1)}return e.push(new i.SupplyDivision([],s,[],s.length)),e},e.prototype.fillDivisions=function(e){var t,r,n=[];try{for(var i=o(e),s=i.next();!s.done;s=i.next()){for(var a=s.value;!a.isFilled;){var d=this.selectRandomCard(a.availableCards);a=a.createDivisionBySelectingCard(d.id)}n.push(a)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},e.prototype.applyCorrections=function(e){var t,r;try{for(var n=o(this.corrections),i=n.next();!i.done;i=n.next()){var s=i.value;s.isSatisfied(e)||(e=s.correctDivisions(e))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return e},e.prototype.gatherCards=function(e){var t,r,n=[];try{for(var i=o(e),s=i.next();!s.done;s=i.next()){var a=s.value;n=n.concat(a.lockedAndSelectedCards)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},e.prototype.orderRequirementsForDivisions=function(e){var t,r,n,i,s=[],a=[];try{for(var d=o(this.requirements),u=d.next();!u.done;u=d.next()){var l=u.value;l.isSatisfied(e)?s.push(l):a.push({requirement:l,count:l.getSatisfyingCardsFromDivisions(e).length})}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=d.return)&&r.call(d)}finally{if(t)throw t.error}}a.sort(function(e,t){return e.count-t.count});var c=[];try{for(var p=o(a),f=p.next();!f.done;f=p.next()){var h=f.value;c.push(h.requirement)}}catch(e){n={error:e}}finally{try{f&&!f.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}return s.concat(c)},e.prototype.getSegmentedRangeForRequirement=function(e,t){var r,i,s=[];try{for(var a=o(t),d=a.next();!d.done;d=a.next()){var u=d.value;u.isFilled?s.push(0):s.push(e.getSatisfyingCardsFromDivisions([u]).length)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return new n.SegmentedRange(0,s)},e.prototype.findIndexOfDivisionContainingCardId=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(!i.isFilled&&r.Cards.findCardById(i.availableCards,t))return n}return-1},e.prototype.getIndexOfDivisionWithMostUnfilledCards=function(e){for(var t=0,r=-1,n=0;n<e.length;n++)e[n].unfilledCount>t&&(t=e[n].unfilledCount,r=n);return r},e.prototype.allowLockedCard=function(e,t){var r,n;try{for(var i=o(this.corrections),s=i.next();!s.done;s=i.next()){if(!s.value.allowLockedCard(e,t))return!1}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return!0},e.prototype.selectRandomCard=function(e){return e[s.getRandomInt(0,e.length)]},e}();t.SupplyBuilder=a}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i,o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};n=[r,t,r(3)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.getLockedAndSelectedCards=function(t){return e.getLockedCards(t).concat(e.getSelectedCards(t))},e.getLockedCards=function(e){var t,r,n=[];try{for(var i=o(e),s=i.next();!s.done;s=i.next()){var a=s.value;n=n.concat(a.lockedCards)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},e.getSelectedCards=function(e){var t,r,n=[];try{for(var i=o(e),s=i.next();!s.done;s=i.next()){var a=s.value;n=n.concat(a.selectedCards)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},e.getAvailableCardsOfType=function(t,r){var n,i,s=e.getAvailableCardsOfTypePerDivision(t,r),a=[];try{for(var d=o(s),u=d.next();!u.done;u=d.next()){var l=u.value;a=a.concat(l)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}return a},e.getAvailableCardsOfTypePerDivision=function(e,t){for(var n=[],i=0;i<e.length;i++){var o=e[i];o.selectedCards.length||!o.isFilled?n.push(o.availableCards.filter(r.Cards.filterByRequiredType(t))):n.push([])}return n},e}();t.SupplyDivisions=n}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(3)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.types=e}return e.prototype.getBannedCards=function(e){return e.filter(r.Cards.filterByAllowedTypes(this.types))},e}();t.TypeSupplyBan=n}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i,o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});n=[r,t,r(3),r(56)],void 0===(i=function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r){var n=e.call(this)||this;return n.type=t,n.requireNewCard=r,n}return s(t,e),t.prototype.isSatisfied=function(t){return!this.requireNewCard&&e.prototype.isSatisfied.call(this,t)},t.prototype.getSatisfyingCards=function(e){return e.filter(r.Cards.filterByRequiredType(this.type))},t.prototype.toString=function(){return"TypeSupplyRequirement(type="+this.type+",requireNewCard="+this.requireNewCard+")"},t}(n.SupplyRequirement);t.TypeSupplyRequirement=i}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};void 0===(n=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.isSatisfied=function(e){var t,r;try{for(var n=i(e),o=n.next();!o.done;o=n.next()){var s=o.value;if(this.getSatisfyingCards(s.lockedAndSelectedCards).length)return!0}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return!1},e.prototype.getSatisfyingCardsFromDivisions=function(e){var t,r,n=[];try{for(var o=i(e),s=o.next();!s.done;s=o.next()){var a=s.value;n=n.concat(this.getSatisfyingCards(a.availableCards))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return n},e}();t.SupplyRequirement=r}.apply(t,[r,t]))||(e.exports=n)},function(e,t,r){var n,i;n=[r,t,r(2)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n,i,o,s,a){this.requireActionProvider=ko.observable(e),this.requireCardProvider=ko.observable(t),this.requireBuyProvider=ko.observable(r),this.allowAttacks=ko.observable(n),this.requireReaction=ko.observable(i),this.requireTrashing=ko.observable(o),this.distributeCost=ko.observable(s),this.prioritizeSet=ko.observable(a)}return e.prototype.toObject=function(){return{requireActionProvider:this.requireActionProvider(),requireCardProvider:this.requireCardProvider(),requireBuyProvider:this.requireBuyProvider(),allowAttacks:this.allowAttacks(),requireReaction:this.requireReaction(),requireTrashing:this.requireTrashing(),distributeCost:this.distributeCost(),prioritizeSet:this.prioritizeSet()}},e.createFromObject=function(t){return new e(null==t.requireActionProvider||!!t.requireActionProvider,null!=t.requireCardProvider&&!!t.requireCardProvider,!!t.requireBuyProvider,null==t.allowAttacks||!!t.allowAttacks,!!t.requireReaction,!!t.requireTrashing,!!t.distributeCost,r.DominionSets.convertToSetIdSafe(t.prioritizeSet))},e}();t.RandomizerSettings=n}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i,o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};n=[r,t,r(2),r(12),r(12),r(29)],void 0===(i=function(e,t,r,n,i,s){"use strict";function a(e,t){return t.length?e+"="+t.map(function(e){return e.shortId}).sort().join(","):""}function d(e,t){var r,n,i=[];try{for(var s=o(e),a=s.next();!a.done;a=s.next()){var d=a.value;try{i.push(t(d))}catch(e){}}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i}function u(e,t){var r=c(e,t);return r?r.split(","):null}function l(e,t){var r=c(e,t);return"1"==r||"true"==r}function c(e,t){var r=new RegExp(e+"=([\\w,]+)").exec(t);return r&&r[1]?r[1]:null}Object.defineProperty(t,"__esModule",{value:!0}),t.serializeKingdom=function(e){var t=[];t.push(a("supply",e.supply.supplyCards)),e.events.length&&t.push(a("events",e.events)),e.landmarks.length&&t.push(a("landmarks",e.landmarks)),e.projects.length&&t.push(a("projects",e.projects));var r=function(e){var t=[];return e.useColonies&&t.push("colonies=1"),e.useShelters&&t.push("shelters=1"),t.join("&")}(e.metadata);return r.length&&t.push(r),t.join("&")},t.deserializeKingdom=function(e){var t=u("supply",e);if(t||(t=u("cards",e)||[]),!t.length)return null;var o=u("events",e)||[],a=u("landmarks",e)||[],c=u("projects",e)||[],p=d(t,r.DominionSets.getSupplyCardById).slice(0,10),f=d(o,r.DominionSets.getEventById).slice(0,2),h=d(a,r.DominionSets.getLandmarkById).slice(0,Math.max(0,2-f.length)),y=d(c,r.DominionSets.getProjectById).slice(0,Math.max(0,2-f.length-h.length)),v=new s.Supply(p,null);return new n.Kingdom(v,f,h,y,function(e){return new i.Metadata(l("colonies",e),l("shelters",e))}(e))}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r,t,r(37)],void 0===(i=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),$.cookie.json=!0,t.loadSettings=function(){try{var e=$.cookie("options")||{},t="string"==typeof e?JSON.parse(e):e;return r.Settings.createFromObject(t)}catch(e){return console.error("Failed to load settings: ",e),r.Settings.createFromObject({})}},t.saveSettings=function(e){$.cookie("options",e.toObject(),{expires:365})}}.apply(t,n))||(e.exports=i)},function(e,t,r){}]);